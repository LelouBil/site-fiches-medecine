---
import "./bootstrap.min.css";
import {Breadcrumb, Navbar} from "astro-bootstrap";
import type {NavbarItemType} from 'astro-bootstrap';
import {arborescence_cours} from "../lib/files";
import {ViewTransitions} from "astro:transitions"

interface Props {
    title: string;
}

const {title} = Astro.props;

const items: NavbarItemType[] = [
    // pull this in from a config file
    {text: 'Acceuil', href: import.meta.env.BASE_URL},
    {text: 'Fiches', href: import.meta.env.BASE_URL + "/ues"},
    {text: 'QCMs', href: import.meta.env.BASE_URL + "/qcms"},
];

const breadcrumbs: { name: string, url: string }[] = []

let path = Astro.url.pathname.replace(import.meta.env.BASE_URL, "").split("/");
if (path[0] === "") {
    path.shift()
}
if (path.length >= 0) {
    // breadcrumbs.push({name: "Accueil", url: import.meta.env.BASE_URL})
}
console.log(path)
if (path.length >= 1) {
    if (path[0] === "ues") {
        breadcrumbs.push({name: "UEs", url: import.meta.env.BASE_URL + "/ues"})
        if (path.length >= 2) {
            let ue = arborescence_cours.find(ue => ue.id === path[1])!
            breadcrumbs.push({name: ue.name, url: import.meta.env.BASE_URL + `/ues/${ue.id}`})
            if (path.length >= 3) {
                let theme = ue.themes.find(theme => theme.id === path[2])!
                breadcrumbs.push({name: theme.name, url: import.meta.env.BASE_URL + `/ues/${ue.id}/${theme.id}`})
                if (path.length >= 4) {
                    let cours = theme.cours.find(cours => cours.id === path[3])!
                    breadcrumbs.push({
                        name: cours.name,
                        url: import.meta.env.BASE_URL + `/ues/${ue.id}/${theme.id}/${cours.id}`
                    })
                }
            }
        }
    } else {
        console.log("Todo breadcrumbs")
    }
}
---

<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8"/>
    <meta name="description" content="Fiches de cours de mÃ©decine"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg"/>
    <meta name="generator" content={Astro.generator}/>
    <base href={Astro.url.pathname + "/"}/>
    <ViewTransitions/>
    <title>{title}</title>
</head>
<body>
<header class="pt-0 px-0 ">
    <Navbar class="navbar-expand-lg bg-primary mb-4" data-bs-theme="dark">
        <div class="container-fluid ms-5">
            <a class="navbar-brand" href="#">Fiches medecine lol</a>
            <Navbar.Items {items} class="me-auto mb-2 mb-lg-0"/>
        </div>
    </Navbar>
    <div class="ms-5 mb-4">
        <Breadcrumb >
            {breadcrumbs.map(breadcrumb => (
                    <Breadcrumb.Item><a href={breadcrumb.url}>{breadcrumb.name}</a></Breadcrumb.Item>
            ))}
        </Breadcrumb>
    </div>
</header>
<main class="mx-5">
    <slot/>
</main>
</body>
</html>
<style is:global>

</style>
