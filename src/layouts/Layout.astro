---
import "./bootstrap.min.css";
import { Breadcrumb, Navbar } from "astro-bootstrap";
import type { NavbarItemType } from "astro-bootstrap";
import { arborescence_cours } from "../lib/files";
import {Image} from "astro:assets"
import faviconSrc from './favicon.png'
import AlgoliaSearch from "../components/AlgoliaSearch.svelte"

import logoSrc from './logo.png'
import githubIcon from './github-mark.svg'
// import {ViewTransitions} from "astro:transitions"

interface Props {
    title: string;
}

const { title } = Astro.props;

const items: NavbarItemType[] = [
    // pull this in from a config file
    {
        text: "Accueil",
        href: import.meta.env.BASE_URL,
        linkClass: Astro.url.pathname == import.meta.env.BASE_URL + "/" ? "active" : ""
    },
    {
        text: "Fiches",
        href: import.meta.env.BASE_URL + "/ues",
        linkClass: Astro.url.pathname.startsWith(import.meta.env.BASE_URL + "/ues") ? "active" : ""
    },
    { text: "QCMs", href: import.meta.env.BASE_URL + "/qcms" }
];

const breadcrumbs: { name: string, url: string }[] = [];

let path = Astro.url.pathname.replace(import.meta.env.BASE_URL, "").split("/");
if (path[0] === "") {
    path.shift();
}
if (path.length >= 0) {
    // breadcrumbs.push({name: "Accueil", url: import.meta.env.BASE_URL})
}
console.log(path);
if (path.length >= 1) {
    if (path[0] === "ues") {
        breadcrumbs.push({ name: "UEs", url: import.meta.env.BASE_URL + "/ues" });
        if (path.length >= 2) {
            let ue = arborescence_cours.find(ue => ue.id === path[1])!;
            breadcrumbs.push({ name: ue.name, url: import.meta.env.BASE_URL + `/ues/${ue.id}` });
            if (path.length >= 3) {
                let theme = ue.themes.find(theme => theme.id === path[2])!;
                breadcrumbs.push({ name: theme.name, url: import.meta.env.BASE_URL + `/ues/${ue.id}/${theme.id}` });
                if (path.length >= 4) {
                    let cours = theme.cours.find(cours => cours.id === path[3])!;
                    breadcrumbs.push({
                        name: cours.name,
                        url: import.meta.env.BASE_URL + `/ues/${ue.id}/${theme.id}/${cours.id}`
                    });
                }
            }
        }
    } else {
        console.log("Todo breadcrumbs");
    }
}
const navBarId = "navbarTogglerTarget";


---

<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8"/>
    <meta name="description" content="Fiches de cours de médecine"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="icon" type="image/png" href={faviconSrc.src}/>
    <meta name="generator" content={Astro.generator}/>
    <base href={Astro.url.pathname + "/"}/>
    <!--<ViewTransitions/>-->
    <title>{title}</title>
</head>
<body style="min-height: 100vh">
<header class="pt-0 px-0">
    <Navbar class="navbar navbar-expand-lg bg-primary mb-3" data-bs-theme="dark">
        <Navbar.Toggler controls={navBarId}/>
        <Navbar.Collapse id={navBarId}>
            <div class="container-fluid ms-5 navbar-nav align-items-center ">
                <a class="navbar-brand" href={import.meta.env.BASE_URL}>
                    <Image loading="eager" src={logoSrc} alt="logo" height="90" />
                </a>
                <Navbar.Items items={items} class="me-auto mb-2 mb-lg-0"/>
            </div>
            <div id="searchbox"
                 class="form-inline mb-lg-0 w-75 d-flex ms-auto me-5">
                <AlgoliaSearch idToDelete="algoliaPlaceHolder" client:only="svelte">
                    <div  id="algoliaPlaceHolder" class="placeholder-glow w-100 h-100" slot="fallback">
                        <div class="placeholder w-100 h-100">&nbsp;</div>
                    </div>
                </AlgoliaSearch>
            </div>
        </Navbar.Collapse>
    </Navbar>
    <div class="ms-5 mb-4 form-inline">
        <Breadcrumb>
            {breadcrumbs.map(breadcrumb => (
                <Breadcrumb.Item><a href={breadcrumb.url}>{breadcrumb.name}</a></Breadcrumb.Item>
            ))}
        </Breadcrumb>
    </div>
</header>
<main class="mx-md-5 mx-2 my-auto" style="min-height: 60vh">
    <slot/>
</main>
<footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 mx-5 border-top">
    <div class="col-md-4 mb-0 text-muted">
        <p class="text-muted mb-2">Contenu par Pierre MARTINI</p>
        <p class="mb-2">Développement par <a class="text-muted" href="https://github.com/LelouBil">LelouBil</a> et <a class="text-muted" href="https://github.com/Tyranozomby">Tyranozomby</a>
            <a class="ms-2" href="https://github.com/LelouBil/site-fiches-medecine"><Image class="d-inline" width="20" src={githubIcon} alt="github icon"/></a>
        </p>
        <p></p>
    </div>
</footer>
</body>
</html>
<script>

    import "bootstrap/dist/js/bootstrap.bundle";

</script>
<style is:global>


    input, .form-check-input {
        border: 1pt solid black;
    }

</style>